# storage

## 设计思路
本包负责存储层实现,主要参考了:
- nano-graphrag 的存储抽象(参考 nano_graphrag.md:28-62)
- GraphRAG 的存储模块(参考 graphrag.md:1219-1227)
- LightRAG 的 Neo4j 实现(参考 lightrag.md:46-48)

### 主要功能
1. 图存储接口与实现
2. 向量存储接口与实现
3. 缓存管理

### 目录结构
```
storage/
├── graph/               # 图存储模块
│   ├── __init__.py
│   ├── base.py         # 基础图存储接口
│   ├── neo4j.py        # Neo4j实现
│   └── networkx.py     # NetworkX实现
├── vector/             # 向量存储模块
│   ├── __init__.py
│   ├── base.py        # 基础向量存储接口
│   ├── faiss.py       # FAISS实现
│   └── milvus.py      # Milvus实现
└── cache/             # 缓存模块
    ├── __init__.py
    ├── base.py       # 基础缓存接口
    ├── memory.py     # 内存缓存实现
    └── redis.py      # Redis缓存实现
```

## 缓存模块的设计特点

1. 统一的接口定义
- get/set 基本操作
- 支持 TTL 过期时间
- 命名空间隔离

2. 内存缓存实现
- 线程安全的字典存储
- 自动过期清理
- 高性能读写

3. 可扩展性
- 易于添加新的缓存后端
- 配置驱动的实例化
- 完整的类型提示

### Redis 缓存实现的主要特点

1. 配置管理
- 支持标准 Redis 连接参数
- 支持密码认证
- 支持数据库选择

2. 数据序列化
- 使用 JSON 序列化/反序列化
- 支持复杂数据类型
- 异常处理机制

3. 命名空间管理
- 继承基类的命名空间机制
- 支持按命名空间清理
- 键名前缀隔离

4. 性能优化
- 连接池复用
- 批量删除支持
- TTL 过期管理

### 向量存储基类的主要特点

1. 配置管理
- 维度配置
- 距离度量类型
- 索引类型选择

2. 集合操作
- 创建/删除集合
- 获取集合统计
- 批量向量操作

3. 搜索功能
- Top-K 检索
- 过滤条件支持
- 元数据管理

4. 异常处理
- 统一的错误处理
- 参数验证
- 状态检查

#### faiss索引实现主要特点
1. 索引管理
- 支持多集合
- 动态创建/删除
- 统计信息查询

2. ID映射机制
- 内部ID到外部ID的映射
- 自动ID生成
- ID一致性维护

3. 元数据管理
- 支持向量元数据
- 过滤查询
- 结果聚合

4. 性能优化
- 类型转换优化
- 批量操作支持
- 内存效率管理

#### Milvus 实现主要特点

1. 连接管理
- 支持身份认证
- 连接池管理
- 异常处理

2. 集合管理
- 灵活的模式定义
- 自动索引创建
- 资源释放

3. 高级搜索
- 表达式过滤
- 参数优化
- 结果格式化

4. 性能优化
- 批量操作
- 索引配置
- 内存管理


## vector/utils类主要特点:

1. 工厂模式
- 统一的存储创建接口
- 支持动态注册新存储类型
- 类型安全的实例化

2. 配置管理
- YAML 配置文件支持
- 灵活的配置结构
- 配置验证和错误处理

3. 扩展性
- 易于添加新存储类型
- 配置驱动的实例化
- 批量加载支持

4. 错误处理
- 类型检查
- 文件存在性验证
- 配置完整性检查